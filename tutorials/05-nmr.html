
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Tutorial 5 - NMR Properties: using Soprano for working with .magres files &#8212; Soprano</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script >mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial 6 - Soprano for defect calculations" href="06-defect_calculations.html" />
    <link rel="prev" title="Tutorial 4 - Clustering analysis" href="04-clustering.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/soprano_logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Soprano</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    About
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../tutorials.html">
   Tutorials
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="01-basic_concepts.html">
     Tutorial 1 - Basic concepts: using AtomsCollection objects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02-generators_properties_calculators.html">
     Tutorial 2 - Generators, Properties and Calculators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-atomselection_transforms.html">
     Tutorial 3 - AtomSelection and transforms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-clustering.html">
     Tutorial 4 - Clustering analysis
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Tutorial 5 - NMR Properties: using Soprano for working with .magres files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06-defect_calculations.html">
     Tutorial 6 - Soprano for defect calculations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../submitter.html">
   Job Submitter
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api.html">
   API reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../_autosummary/soprano.html">
     soprano
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../_autosummary/soprano.analyse.html">
       soprano.analyse
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.analyse.phylogen.html">
         soprano.analyse.phylogen
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../_autosummary/soprano.calculate.html">
       soprano.calculate
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.calculate.gulp.html">
         soprano.calculate.gulp
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.calculate.nmr.html">
         soprano.calculate.nmr
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.calculate.powder.html">
         soprano.calculate.powder
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.calculate.xrd.html">
         soprano.calculate.xrd
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../_autosummary/soprano.collection.html">
       soprano.collection
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
      <label for="toctree-checkbox-6">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.collection.collection.html">
         soprano.collection.collection
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.collection.generate.html">
         soprano.collection.generate
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../_autosummary/soprano.data.html">
       soprano.data
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.data.nmr.html">
         soprano.data.nmr
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.data.vdw.html">
         soprano.data.vdw
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../_autosummary/soprano.hpc.html">
       soprano.hpc
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
      <label for="toctree-checkbox-8">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.hpc.submitter.html">
         soprano.hpc.submitter
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../_autosummary/soprano.measure.html">
       soprano.measure
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../_autosummary/soprano.nmr.html">
       soprano.nmr
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
      <label for="toctree-checkbox-9">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.nmr.tensor.html">
         soprano.nmr.tensor
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.nmr.utils.html">
         soprano.nmr.utils
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../_autosummary/soprano.optional.html">
       soprano.optional
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../_autosummary/soprano.properties.html">
       soprano.properties
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
      <label for="toctree-checkbox-10">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.properties.atomsproperty.html">
         soprano.properties.atomsproperty
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.properties.basic.html">
         soprano.properties.basic
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.properties.castep.html">
         soprano.properties.castep
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.properties.labeling.html">
         soprano.properties.labeling
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.properties.linkage.html">
         soprano.properties.linkage
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.properties.map.html">
         soprano.properties.map
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.properties.nmr.html">
         soprano.properties.nmr
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.properties.order.html">
         soprano.properties.order
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.properties.symmetry.html">
         soprano.properties.symmetry
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.properties.transform.html">
         soprano.properties.transform
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../_autosummary/soprano.rnd.html">
       soprano.rnd
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../_autosummary/soprano.scripts.html">
       soprano.scripts
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
      <label for="toctree-checkbox-11">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.scripts.msaverage.html">
         soprano.scripts.msaverage
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.scripts.phylogen.html">
         soprano.scripts.phylogen
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../_autosummary/soprano.scripts.vasp2cell.html">
         soprano.scripts.vasp2cell
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../_autosummary/soprano.selection.html">
       soprano.selection
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../_autosummary/soprano.utils.html">
       soprano.utils
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../citing.html">
   Citing Soprano
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            A Python library to crack crystals
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/CCP-NC/soprano/master?urlpath=tree/docs/tutorials/05-nmr.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/CCP-NC/soprano"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/CCP-NC/soprano/issues/new?title=Issue%20on%20page%20%2Ftutorials/05-nmr.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/tutorials/05-nmr.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Tutorial 5 - NMR Properties: using Soprano for working with .magres files
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-magres-files">
     1 - Loading magres files
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#labels-and-indices">
     2 - Labels and indices
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#magnetic-shieldings-and-chemical-shifts">
     3 - Magnetic shieldings and chemical shifts
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#electric-field-gradients-and-quadrupolar-couplings">
     4 - Electric field gradients and quadrupolar couplings
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dipolar-couplings">
   5 - Dipolar couplings
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#j-couplings-indirect-spin-spin-coupling">
   6 J-couplings (indirect spin-spin coupling)
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-simple-spectra">
   7 - Creating simple spectra
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Tutorial 5 - NMR Properties: using Soprano for working with .magres files</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Tutorial 5 - NMR Properties: using Soprano for working with .magres files
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-magres-files">
     1 - Loading magres files
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#labels-and-indices">
     2 - Labels and indices
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#magnetic-shieldings-and-chemical-shifts">
     3 - Magnetic shieldings and chemical shifts
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#electric-field-gradients-and-quadrupolar-couplings">
     4 - Electric field gradients and quadrupolar couplings
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dipolar-couplings">
   5 - Dipolar couplings
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#j-couplings-indirect-spin-spin-coupling">
   6 J-couplings (indirect spin-spin coupling)
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-simple-spectra">
   7 - Creating simple spectra
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="tutorial-5-nmr-properties-using-soprano-for-working-with-magres-files">
<h1>Tutorial 5 - NMR Properties: using Soprano for working with .magres files<a class="headerlink" href="#tutorial-5-nmr-properties-using-soprano-for-working-with-magres-files" title="Permalink to this headline">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      <span class="n">_</span>
    <span class="o">/|</span><span class="n">_</span><span class="o">|</span>\   
   <span class="o">/</span> <span class="o">/</span> \ \  
  <span class="o">/</span><span class="n">_</span><span class="o">/</span>   \<span class="n">_</span>\  
  \ \   <span class="o">/</span> <span class="o">/</span>  
   \ \<span class="n">_</span><span class="o">/</span> <span class="o">/</span>  
    \<span class="o">|</span><span class="n">_</span><span class="o">|/</span>  

</pre></div>
</div>
<p>SOPRANO: a Python library for generation, manipulation and analysis of large batches of crystalline structures</p>
<p><em>Developed within the CCP-NC project. Copyright STFC 2022</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic imports</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">))</span> <span class="c1"># This to add the Soprano path to the PYTHONPATH</span>
                                          <span class="c1"># so we can load it without installing it</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Other useful imports</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">ase</span>
<span class="kn">from</span> <span class="nn">ase</span> <span class="kn">import</span> <span class="n">io</span> <span class="k">as</span> <span class="n">ase_io</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.pyplot._IonContext at 0x7fcd840d17f0&gt;
</pre></div>
</div>
</div>
</div>
<section id="loading-magres-files">
<h2>1 - Loading magres files<a class="headerlink" href="#loading-magres-files" title="Permalink to this headline">¶</a></h2>
<p>ASE can read the Magres file format from version 3.11.0 (~2016). If your version of ASE does not support loading Magres files, try updating it or download the bleeding edge version from GitLab:</p>
<p><a class="reference external" href="https://gitlab.com/ase/ase">https://gitlab.com/ase/ase</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C2H5O</span> <span class="o">=</span> <span class="n">ase_io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;tutorial_data/ethanol.magres&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="labels-and-indices">
<h2>2 - Labels and indices<a class="headerlink" href="#labels-and-indices" title="Permalink to this headline">¶</a></h2>
<p>Labels and indices used in the magres file are stored in their own arrays and can be easily accessed and used to select atoms.</p>
<p>If you use CASTEP and obtain your initial structure from a CIF file, note that you can use <code class="docutils literal notranslate"><span class="pre">cif2cell</span></code> with the <code class="docutils literal notranslate"><span class="pre">--export-cif-labels</span></code> flag to use the CIF site labels in your CASTEP .cell file. These labels will then be output in the generated .magres file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">C2H5O</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">C2H5O</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;indices&#39;</span><span class="p">)</span>

<span class="c1"># Select only the protons&#39; indices</span>
<span class="n">H_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">C2H5O</span><span class="p">[</span><span class="n">H_i</span><span class="p">]</span>
<span class="c1"># Select only C2</span>
<span class="n">C2_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">indices</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">C2</span> <span class="o">=</span> <span class="n">C2H5O</span><span class="p">[</span><span class="n">C2_i</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There are </span><span class="si">{0}</span><span class="s2"> hydrogen atom(s)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The C2 atom is positioned at x = </span><span class="si">{0}</span><span class="s2">, y = </span><span class="si">{1}</span><span class="s2">, z = </span><span class="si">{2}</span><span class="s2"> Ang&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">C2</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 1 hydrogen atom(s)
The C2 atom is positioned at x = -0.247915, y = 1.164107, z = 0.937396 Ang
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># One can also recreate the Jmol/MagresView-style labels if needed:</span>
<span class="n">jmol_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">indices</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The labels are </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jmol_labels</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The labels are H_1, H_2, H_3, H_4, H_5, H_6, C_1, C_2, O_1
</pre></div>
</div>
</div>
</div>
</section>
<section id="magnetic-shieldings-and-chemical-shifts">
<h2>3 - Magnetic shieldings and chemical shifts<a class="headerlink" href="#magnetic-shieldings-and-chemical-shifts" title="Permalink to this headline">¶</a></h2>
<p>All the NMR tensors stored in the original .magres file are saved as arrays in the Atoms object and can be accessed directly. However, Soprano also provides a set of properties to express the tensors in the form of parameters useful to compute the spectrum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">soprano.properties.nmr</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Isotropy, Anisotropy and Asymmetry (Haeberlen convention)</span>
<span class="c1"># These return arrays of the same length as the number of atoms.</span>
<span class="n">iso</span> <span class="o">=</span> <span class="n">MSIsotropy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">C2H5O</span><span class="p">)</span>
<span class="n">aniso</span> <span class="o">=</span> <span class="n">MSAnisotropy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">C2H5O</span><span class="p">)</span>
<span class="n">asymm</span> <span class="o">=</span> <span class="n">MSAsymmetry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">C2H5O</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Label</span><span class="se">\t</span><span class="s1">Isotropy</span><span class="se">\t</span><span class="s1">Anisotropy</span><span class="se">\t</span><span class="s1">Asymmetry&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jmol_labels</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\t</span><span class="si">{1:6.2f}</span><span class="s1"> ppm</span><span class="se">\t</span><span class="si">{2:6.2f}</span><span class="s1"> ppm</span><span class="se">\t</span><span class="si">{3:3.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jl</span><span class="p">,</span> <span class="n">iso</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">aniso</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">asymm</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Label	Isotropy	Anisotropy	Asymmetry
H_1	 29.59 ppm	  8.94 ppm	0.14
H_2	 30.26 ppm	  8.19 ppm	0.21
H_3	 30.10 ppm	  7.29 ppm	0.06
H_4	 26.98 ppm	  8.17 ppm	0.94
H_5	 27.39 ppm	 -7.12 ppm	0.93
H_6	 31.98 ppm	 14.12 ppm	0.45
C_1	156.47 ppm	 33.80 ppm	0.70
C_2	109.86 ppm	 70.25 ppm	0.41
O_1	268.03 ppm	-51.38 ppm	0.98
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Span and skew</span>
<span class="n">span</span> <span class="o">=</span> <span class="n">MSSpan</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">C2H5O</span><span class="p">)</span>
<span class="n">skew</span> <span class="o">=</span> <span class="n">MSSkew</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">C2H5O</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Label</span><span class="se">\t</span><span class="s1">  Span</span><span class="se">\t\t</span><span class="s1"> Skew&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jmol_labels</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\t</span><span class="si">{1:6.2f}</span><span class="s1"> ppm</span><span class="se">\t</span><span class="si">{2:6.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jl</span><span class="p">,</span> <span class="n">span</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">skew</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Label	  Span		 Skew
H_1	  9.36 ppm	 -0.82
H_2	  8.76 ppm	 -0.74
H_3	  7.43 ppm	 -0.92
H_4	 10.72 ppm	 -0.05
H_5	  9.33 ppm	  0.05
H_6	 16.25 ppm	 -0.48
C_1	 41.73 ppm	 -0.24
C_2	 79.95 ppm	 -0.51
O_1	 68.22 ppm	  0.01
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Quaternion (orientation of the tensor with respect to the Cartesian axes)</span>
<span class="c1"># from which we extract the Euler angles</span>

<span class="n">quat</span> <span class="o">=</span> <span class="n">MSQuaternion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">C2H5O</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Label</span><span class="se">\t</span><span class="s1"> alpha/deg</span><span class="se">\t</span><span class="s1">beta/deg</span><span class="se">\t</span><span class="s1">gamma/deg&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jmol_labels</span><span class="p">):</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">quat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">euler_angles</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;zyz&#39;</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># rad to degrees</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\t</span><span class="si">{1:8.2f}</span><span class="se">\t</span><span class="si">{2:8.2f}</span><span class="se">\t</span><span class="si">{3:8.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jl</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Label	 alpha/deg	beta/deg	gamma/deg
H_1	  -27.96	  134.66	   26.84
H_2	  -92.66	   77.37	   86.77
H_3	  177.96	  144.86	  -13.54
H_4	  177.34	   96.81	  -64.85
H_5	   53.84	  116.78	 -134.91
H_6	   60.93	  137.71	   25.35
C_1	  -93.10	  132.57	  -27.03
C_2	   -9.26	  125.07	 -138.63
O_1	   66.77	  120.41	 -125.99
</pre></div>
</div>
</div>
</div>
</section>
<section id="electric-field-gradients-and-quadrupolar-couplings">
<h2>4 - Electric field gradients and quadrupolar couplings<a class="headerlink" href="#electric-field-gradients-and-quadrupolar-couplings" title="Permalink to this headline">¶</a></h2>
<p>Similarly named properties exist for the EFG tensors - EFGSpan, EFGAnisotropy, EFGQuaternion, etc. A few more are specific (and of course there’s no EFGIsotropy, for obvious reasons).
The most important difference is of course the introduction of the quadrupolar constant <span class="math notranslate nohighlight">\(\chi\)</span>, namely:</p>
<p><span class="math notranslate nohighlight">\(\chi = \frac{e^2qQ}{h}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(e\)</span> is the elementary charge, <span class="math notranslate nohighlight">\(V_{zz}=eq\)</span>, <span class="math notranslate nohighlight">\(Q\)</span> is the quadrupole moment of the given element and isotope and <span class="math notranslate nohighlight">\(h\)</span> the Planck constant. This definition returns a frequency. If one wants a pulsation <span class="math notranslate nohighlight">\(\omega\)</span> it needs to multiplied by a factor of <span class="math notranslate nohighlight">\(2\pi\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Vzz component, in atomic units</span>

<span class="n">vzz</span> <span class="o">=</span> <span class="n">EFGVzz</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">C2H5O</span><span class="p">)</span>

<span class="c1"># For quadrupolar constants, isotopes become relevant. This means we need to create custom Property instances to</span>
<span class="c1"># specify them. There are multiple ways to do so - check the docstrings for more details - but here we set them</span>
<span class="c1"># by element. When nothing is specified it defaults to the most common NMR active isotope.</span>

<span class="n">qP</span> <span class="o">=</span> <span class="n">EFGQuadrupolarConstant</span><span class="p">(</span><span class="n">isotopes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span> <span class="c1"># Deuterated; for the others use the default</span>
<span class="n">qC</span> <span class="o">=</span> <span class="n">qP</span><span class="p">(</span><span class="n">C2H5O</span><span class="p">)</span><span class="o">/</span><span class="mf">1e6</span> <span class="c1"># To MHz</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Label</span><span class="se">\t</span><span class="s1">Vzz</span><span class="se">\t\t</span><span class="s1">Chi&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jmol_labels</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\t</span><span class="si">{1:5.2f}</span><span class="s1"> au</span><span class="se">\t</span><span class="si">{2:5.2f}</span><span class="s1"> MHz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jl</span><span class="p">,</span> <span class="n">vzz</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qC</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Label	Vzz		Chi
H_1	 0.29 au	 0.19 MHz
H_2	 0.28 au	 0.19 MHz
H_3	 0.29 au	 0.20 MHz
H_4	 0.27 au	 0.18 MHz
H_5	 0.28 au	 0.19 MHz
H_6	 0.44 au	 0.30 MHz
C_1	 0.04 au	 0.00 MHz
C_2	 0.40 au	 0.00 MHz
O_1	-1.86 au	11.19 MHz
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="dipolar-couplings">
<h1>5 - Dipolar couplings<a class="headerlink" href="#dipolar-couplings" title="Permalink to this headline">¶</a></h1>
<p>Soprano can compute dipolar couplings between any pair of atoms, defined as:</p>
<div class="math notranslate nohighlight">
\[
d_{ij} = -\frac{\mu_0\hbar\gamma_i\gamma_j}{8\pi^2r_{ij}^3}
\]</div>
<p>where the <span class="math notranslate nohighlight">\(\gamma\)</span> represent the gyromagnetic ratios of the nuclei and the
<span class="math notranslate nohighlight">\(r\)</span> is their distance. The full tensor of the interaction is then defined as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
         D_{ij} =
         \begin{bmatrix}
          -d_{ij}   &amp; 0         &amp; 0       \\
          0         &amp; -d_{ij}   &amp; 0       \\
          0         &amp; 0         &amp; 2d_{ij} \\
         \end{bmatrix}
\end{split}\]</div>
<p>See the <a class="reference external" href="https://ccp-nc.github.io/soprano/_autosummary/soprano.properties.nmr.dipolar.html#soprano.properties.nmr.dipolar.DipolarCoupling">DipolarCoupling reference for more information.</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s say we only want the homonuclear H dipolar couplings. We first select the indices of the H atoms</span>
<span class="kn">from</span> <span class="nn">soprano.selection</span> <span class="kn">import</span> <span class="n">AtomSelection</span>
<span class="n">selH</span> <span class="o">=</span> <span class="n">AtomSelection</span><span class="o">.</span><span class="n">from_element</span><span class="p">(</span><span class="n">C2H5O</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="c1"># dip is a dictionary of the form {(i,j): [dipolar_coupling, vector]}</span>
<span class="n">dip</span> <span class="o">=</span> <span class="n">DipolarCoupling</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">C2H5O</span><span class="p">,</span>                 <span class="c1"># the crystal structure (ASE Atoms object)</span>
        <span class="n">sel_i</span> <span class="o">=</span> <span class="n">selH</span><span class="p">,</span>          <span class="c1"># this can either be a list of indices or an AtomSelection object</span>
        <span class="n">sel_j</span> <span class="o">=</span> <span class="n">selH</span><span class="p">,</span>          <span class="c1"># this is redundant in this case, but it&#39;s good practice to specify it</span>
        <span class="n">isotopes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>   <span class="c1"># You can specify whatever isotope you want here.</span>
        <span class="n">self_coupling</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># include interactions with itself</span>
        <span class="p">)</span>
<span class="c1"># sort dictiorary by keys (i.e. sort by (i,j) indices)</span>
<span class="n">dip</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">dip</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dip</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>

<span class="c1"># print the dipolar couplings</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;i</span><span class="se">\t</span><span class="s1">j</span><span class="se">\t</span><span class="s1">Dipolar coupling/kHz&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dip</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="mf">1e3</span> <span class="c1"># to kHz</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">jmol_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">jmol_labels</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">d</span><span class="si">:</span><span class="s2">10.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>i	j	Dipolar coupling/kHz
H_1	H_2	    -21.68
H_1	H_3	    -21.36
H_1	H_4	     -7.60
H_1	H_5	     -7.57
H_1	H_6	     -2.52
H_2	H_3	    -21.55
H_2	H_4	     -7.52
H_2	H_5	     -4.17
H_2	H_6	     -7.50
H_3	H_4	     -4.16
H_3	H_5	     -7.69
H_3	H_6	     -4.57
H_4	H_5	    -21.79
H_4	H_6	     -9.50
H_5	H_6	     -5.39
</pre></div>
</div>
</div>
</div>
</section>
<section id="j-couplings-indirect-spin-spin-coupling">
<h1>6 J-couplings (indirect spin-spin coupling)<a class="headerlink" href="#j-couplings-indirect-spin-spin-coupling" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://ccp-nc.github.io/soprano/_autosummary/soprano.properties.nmr.isc.html#soprano.properties.nmr.isc.JCIsotropy"><code class="docutils literal notranslate"><span class="pre">JCIsotropy</span></code></a> produces a dictionary of J coupling isotropies for atom pairs in the system. See <a class="reference external" href="https://ccp-nc.github.io/soprano/_autosummary/soprano.properties.nmr.isc.html#soprano.properties.nmr.isc.JCDiagonal"><code class="docutils literal notranslate"><span class="pre">JCDiagonal</span></code></a> for how reduced couplings are transformed into couplings.</p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">tag</span></code> argument to select the J-coupling component to return.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tag</span> <span class="p">(</span><span class="nb">str</span><span class="p">):</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">J</span> <span class="n">coupling</span> <span class="n">component</span> <span class="n">to</span> <span class="k">return</span><span class="o">.</span> <span class="n">Magres</span> <span class="n">files</span>
              <span class="n">usually</span> <span class="n">contain</span> <span class="n">isc</span><span class="p">,</span> <span class="n">isc_spin</span><span class="p">,</span> <span class="n">isc_fc</span><span class="p">,</span> <span class="n">isc_orbital_p</span> <span class="ow">and</span>
              <span class="n">isc_orbital_d</span><span class="o">.</span> <span class="n">Default</span> <span class="ow">is</span> <span class="n">isc</span><span class="o">.</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">soprano.properties.nmr.isc</span> <span class="kn">import</span> <span class="n">JCIsotropy</span>
<span class="n">jcoupling</span> <span class="o">=</span> <span class="n">JCIsotropy</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">C2H5O</span><span class="p">,</span>                 <span class="c1"># the crystal structure (ASE Atoms object)</span>
        <span class="n">isotopes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>   <span class="c1"># You can specify whatever isotopes you want here.</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;isc&#39;</span><span class="p">,</span>           <span class="c1"># Which J coupling component to use. &#39;isc&#39; is default. See your magres file for what has been computed.  </span>
        <span class="n">self_coupling</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># include interactions with periodic images of self?</span>
        <span class="p">)</span>
        
<span class="c1"># Now we print out the couplings</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;i</span><span class="se">\t</span><span class="s1">j</span><span class="se">\t</span><span class="s1">J coupling/Hz&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">jcoup</span> <span class="ow">in</span> <span class="n">jcoupling</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="c1"># We can filter out the couplings to just the largest ones e.g.</span>
    <span class="c1"># to only print out the couplings larger than 5 Hz:</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">jcoup</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span> 
         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">jmol_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">jmol_labels</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">jcoup</span><span class="si">:</span><span class="s2">10.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>i	j	J coupling/Hz
H_1	C_1	     15.67
H_2	C_1	     16.05
H_3	C_1	     16.27
H_4	C_2	     17.64
H_5	C_2	     17.87
H_6	O_1	     -9.65
C_1	C_2	     29.16
C_2	O_1	     15.61
</pre></div>
</div>
</div>
</div>
</section>
<section id="creating-simple-spectra">
<h1>7 - Creating simple spectra<a class="headerlink" href="#creating-simple-spectra" title="Permalink to this headline">¶</a></h1>
<p>Besides handling NMR properties, Soprano also allows you to create simple simulations of NMR spectra. These are only computed by considering the known properties of shielding and quadrupolar interactions, which means that their accuracy is limited; they are <em>not</em> spin dynamics simulations and should be treated as such. Currently these include orientational as well as isotropic effects, up to the second order for quadrupole interactions. The limit of infinite speed MAS is included as well. They do NOT include:</p>
<ul class="simple">
<li><p>dipolar interactions</p></li>
<li><p>J-couplings</p></li>
<li><p>finite spinning speed effects</p></li>
<li><p>cross-polarisation or other pulse sequence effects</p></li>
</ul>
<p>See <a class="reference external" href="https://ccp-nc.github.io/soprano/_autosummary/soprano.calculate.nmr.nmr.html#soprano.calculate.nmr.nmr.NMRCalculator"><code class="docutils literal notranslate"><span class="pre">NMRCalculator</span></code></a> for the full reference documentation.</p>
<p>For more advanced simulations using <a class="reference external" href="https://doi.org/10.1006/jmre.2000.2179">Simpson</a>, see the Soprano interface reference: <a class="reference external" href="https://ccp-nc.github.io/soprano/_autosummary/soprano.calculate.nmr.simpson.html#soprano.calculate.nmr.simpson.SimpsonSequence"><code class="docutils literal notranslate"><span class="pre">SimpsonSequence</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s look at the ethanol molecule. First we create an NMR calculator</span>

<span class="kn">from</span> <span class="nn">soprano.calculate.nmr.nmr</span> <span class="kn">import</span> <span class="n">NMRCalculator</span><span class="p">,</span> <span class="n">NMRFlags</span>

<span class="n">nCalc</span> <span class="o">=</span> <span class="n">NMRCalculator</span><span class="p">(</span><span class="n">C2H5O</span><span class="p">)</span> <span class="c1"># We create the calculator here</span>

<span class="c1"># Setting the Larmor frequency; default units are MHz</span>
<span class="c1"># This is set for a specific isotope and determines the magnetic field for everything else as well</span>
<span class="n">nCalc</span><span class="o">.</span><span class="n">set_larmor_frequency</span><span class="p">(</span><span class="mf">42.6</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s1">&#39;1H&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Field: </span><span class="si">{0:.2f}</span><span class="s2"> T&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nCalc</span><span class="o">.</span><span class="n">B</span><span class="p">))</span>
<span class="c1"># We can also get what the frequency would be for a different element...</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Larmor frequency for 13C: </span><span class="si">{0:.2f}</span><span class="s2"> MHz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nCalc</span><span class="o">.</span><span class="n">get_larmor_frequency</span><span class="p">(</span><span class="s1">&#39;13C&#39;</span><span class="p">)))</span>

<span class="c1"># Set a reference shielding, in ppm</span>
<span class="n">nCalc</span><span class="o">.</span><span class="n">set_reference</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;1H&#39;</span><span class="p">)</span>

<span class="c1"># Set a powder averaging. Higher values of N mean finer average</span>
<span class="n">nCalc</span><span class="o">.</span><span class="n">set_powder</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Powder orientations: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nCalc</span><span class="o">.</span><span class="n">_orients</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Field: 1.00 T
Larmor frequency for 13C: 10.71 MHz
Powder orientations: 545
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute the spectrum for protons; only chemical shielding, including anisotropy effects</span>
<span class="n">freqRange</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">spec1H_aniso</span><span class="p">,</span> <span class="n">freqs</span> <span class="o">=</span> <span class="n">nCalc</span><span class="o">.</span><span class="n">spectrum_1d</span><span class="p">(</span><span class="s1">&#39;1H&#39;</span><span class="p">,</span> <span class="n">effects</span><span class="o">=</span><span class="n">NMRFlags</span><span class="o">.</span><span class="n">STATIC</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="n">freqRange</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">501</span><span class="p">)</span>
<span class="c1"># Now only the isotropic lines (as if spinning)</span>
<span class="c1"># We add a broadening to make the lines more visible</span>
<span class="n">spec1H_iso</span><span class="p">,</span> <span class="n">freqs</span> <span class="o">=</span> <span class="n">nCalc</span><span class="o">.</span><span class="n">spectrum_1d</span><span class="p">(</span><span class="s1">&#39;1H&#39;</span><span class="p">,</span> <span class="n">effects</span><span class="o">=</span><span class="n">NMRFlags</span><span class="o">.</span><span class="n">MAS</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="n">freqRange</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">501</span><span class="p">,</span>
                                      <span class="n">freq_broad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">spec1H_aniso</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Static line&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">spec1H_iso</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Isotropic shifts&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fcd58dc2250&gt;
</pre></div>
</div>
<img alt="../_images/05-nmr_21_1.png" src="../_images/05-nmr_21_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now let&#39;s look at the static quadrupolar line of 17O</span>
<span class="n">freqRange</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">spec17O_1</span><span class="p">,</span> <span class="n">freqs</span> <span class="o">=</span> <span class="n">nCalc</span><span class="o">.</span><span class="n">spectrum_1d</span><span class="p">(</span><span class="s1">&#39;17O&#39;</span><span class="p">,</span> <span class="n">effects</span><span class="o">=</span><span class="n">NMRFlags</span><span class="o">.</span><span class="n">Q_1_ORIENT</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="n">freqRange</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=-</span><span class="n">freqRange</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">501</span><span class="p">)</span>
<span class="n">spec17O_s</span><span class="p">,</span> <span class="n">freqs</span> <span class="o">=</span> <span class="n">nCalc</span><span class="o">.</span><span class="n">spectrum_1d</span><span class="p">(</span><span class="s1">&#39;17O&#39;</span><span class="p">,</span> <span class="n">effects</span><span class="o">=</span><span class="n">NMRFlags</span><span class="o">.</span><span class="n">Q_STATIC</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=</span><span class="n">freqRange</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=-</span><span class="n">freqRange</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">501</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">spec17O_1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;First order&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">spec17O_s</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;First+second order&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fcd5cb87bb0&gt;
</pre></div>
</div>
<img alt="../_images/05-nmr_23_1.png" src="../_images/05-nmr_23_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># There&#39;s a number of other possible NMRFlags for various effects...</span>
<span class="k">for</span> <span class="n">fl</span> <span class="ow">in</span> <span class="n">NMRFlags</span><span class="o">.</span><span class="n">_fields</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CS_ISO
CS_ORIENT
CS
Q_1_ORIENT
Q_2_SHIFT
Q_2_ORIENT_STATIC
Q_2_ORIENT_MAS
Q_2_STATIC
Q_2_MAS
Q_STATIC
Q_MAS
STATIC
MAS
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="04-clustering.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Tutorial 4 - Clustering analysis</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="06-defect_calculations.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tutorial 6 - Soprano for defect calculations</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By CCP-NC<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>