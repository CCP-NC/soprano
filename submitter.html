
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Job Submitter &#8212; Soprano</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=5eb1bb1e"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'submitter';</script>
    <link rel="icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API reference" href="api.html" />
    <link rel="prev" title="Tutorial 6 - Soprano for defect calculations" href="tutorials/06-defect_calculations.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/soprano_logo.svg" class="logo__image only-light" alt="Soprano - Home"/>
    <script>document.write(`<img src="_static/soprano_logo.svg" class="logo__image only-dark" alt="Soprano - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    About
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials/01-basic_concepts.html">Tutorial 1 - Basic concepts: using AtomsCollection objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/02-generators_properties_calculators.html">Tutorial 2 - Generators, Properties and Calculators</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/03-atomselection_transforms.html">Tutorial 3 - AtomSelection and transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/04-clustering.html">Tutorial 4 - Clustering analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/05-nmr.html">Tutorial 5 - NMR Properties: using Soprano for working with .magres files</a></li>




<li class="toctree-l2"><a class="reference internal" href="tutorials/06-defect_calculations.html">Tutorial 6 - Soprano for defect calculations</a></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Job Submitter</a></li>

<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">API reference</a><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="_autosummary/soprano.html">soprano</a><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/soprano.analyse.html">soprano.analyse</a><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.analyse.phylogen.html">soprano.analyse.phylogen</a></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/soprano.calculate.html">soprano.calculate</a><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.calculate.gulp.html">soprano.calculate.gulp</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.calculate.nmr.html">soprano.calculate.nmr</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.calculate.powder.html">soprano.calculate.powder</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.calculate.xrd.html">soprano.calculate.xrd</a></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/soprano.collection.html">soprano.collection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.collection.collection.html">soprano.collection.collection</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.collection.generate.html">soprano.collection.generate</a></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/soprano.data.html">soprano.data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.data.nmr.html">soprano.data.nmr</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.data.vdw.html">soprano.data.vdw</a></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/soprano.hpc.html">soprano.hpc</a><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.hpc.submitter.html">soprano.hpc.submitter</a></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/soprano.measure.html">soprano.measure</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/soprano.nmr.html">soprano.nmr</a><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.nmr.tensor.html">soprano.nmr.tensor</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.nmr.utils.html">soprano.nmr.utils</a></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/soprano.optional.html">soprano.optional</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/soprano.properties.html">soprano.properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.properties.atomsproperty.html">soprano.properties.atomsproperty</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.properties.basic.html">soprano.properties.basic</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.properties.castep.html">soprano.properties.castep</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.properties.labeling.html">soprano.properties.labeling</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.properties.linkage.html">soprano.properties.linkage</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.properties.map.html">soprano.properties.map</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.properties.nmr.html">soprano.properties.nmr</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.properties.order.html">soprano.properties.order</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.properties.symmetry.html">soprano.properties.symmetry</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.properties.transform.html">soprano.properties.transform</a></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/soprano.rnd.html">soprano.rnd</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/soprano.scripts.html">soprano.scripts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.scripts.msaverage.html">soprano.scripts.msaverage</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.scripts.phylogen.html">soprano.scripts.phylogen</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/soprano.scripts.vasp2cell.html">soprano.scripts.vasp2cell</a></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/soprano.selection.html">soprano.selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/soprano.utils.html">soprano.utils</a></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>
</ul><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary>
</details></li>

<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing Soprano</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/CCP-NC/soprano" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/CCP-NC/soprano/issues/new?title=Issue%20on%20page%20%2Fsubmitter.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/submitter.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Job Submitter</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Job Submitter</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#deploying-a-submitter">Deploying a Submitter</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-a-submitter-class">Writing a Submitter class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-a-tagged-submission-script">Writing a tagged submission script</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-submitter-instance">Creating a Submitter instance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#launching-a-submitter">Launching a Submitter</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="job-submitter">
<h1>Job Submitter<a class="headerlink" href="#job-submitter" title="Link to this heading">#</a></h1>
<p>In Soprano, the <code class="docutils literal notranslate"><span class="pre">hpc.submitter</span></code> module provides classes and tools meant
to help computational scientists to automate the process of generating,
running and possibly post-processing huge batches of molecular
calculations like molecular dynamics, DFT calculations and so on on high
performance computing machines where access to the nodes is regulated by
a queueing system. The target is to allow users to create their own
pipelines for high throughput calculations, like running the same
analysis tools through an entire database of chemical structures, with
only a few lines of Python code. Since this is, however, still a complex
task that will inevitably require to be customised and tailored to the
needs of each specific case, using this functionality requires a
somewhat higher level of programming confidence than the rest of the
library and can look a little daunting at first. No worries - this
manual will guide you through the steps necessary to deploy your own
Submitter to your machine of interest to run potentially any
computational task you can think of. Besides instructions on the
creation of a new Submitter, this manual also will include advice on how
to test it and debug it locally, in order to minimise the risk of
running into bugs after deploying the system. First, let us clarify what
a Soprano Submitter instance <em>is</em> and <em>isn’t</em>. A Submitter is a very
general class designed to automate the process of queueing, running and
postprocessing huge amounts of calculations on a computing cluster. It
can be used to do this locally on the machine it is running on or to use
a remote system to do the heavy lifting. It is <em>not</em>:</p>
<ul class="simple">
<li><p>a system handling parallel calculations. There is no parallelism
included in a Submitter. As the name suggests, it simply submits
jobs to a queueing system like GridEngine, which then itself
provides them with the required number of cores. To achieve maximum
compatibility, the Submitter is entirely agnostic of the underlying
hardware architecture;</p></li>
<li><p>a system ready for deployment as-is. As it comes shipped with
Soprano, the Submitter class basically does nothing. It is meant to
be used as a parent class to write your own sub-class which
specifies the details of the task of interest through a number of
designated methods. This is absolutely on purpose - the objective
here is maximum flexibility for potentially very demanding tasks,
sacrificing immediate usability;</p></li>
<li><p>a system meant to work as a server running continuously and
accepting a flow of user requests. While it is possible to have a
Submitter run indefinitely it is not advised to rely on it that way,
as it currently lacks the robustness to deal with all the errors
that could happen during that kind of usage and to restart itself in
case of a crash. Rather, it should be best employed with runs of
definite size, with a clear end in sight.</p></li>
</ul>
<p>Now let’s see a quick overview of what the typical pipeline for
deploying a Submitter system is, followed by a more detailed explanation
of all the steps involved.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="deploying-a-submitter">
<h1>Deploying a Submitter<a class="headerlink" href="#deploying-a-submitter" title="Link to this heading">#</a></h1>
<p>The process to create and launch a Submitter requires the following
steps:</p>
<ul class="simple">
<li><p>Write a class inheriting from <code class="docutils literal notranslate"><span class="pre">soprano.hpc.submitter.Submitter</span></code>
implementing the desired calculation through its core methods;</p></li>
<li><p>Create a submission script for your HPC system using tags which are
going to be replaced by specific values in each job;</p></li>
<li><p>Write a Python source file creating an instance of this class (it
can also be the same file) and setting up its parameters, and
positioning this file in the working directory. In some cases this
might require creating a <code class="docutils literal notranslate"><span class="pre">soprano.hpc.submitter.QueueInterface</span></code> as
well;</p></li>
<li><p>Launch the newly created submitter from the command line by calling
the appropriate Soprano script.</p></li>
</ul>
<p>Let’s see these steps in more detail.</p>
<section id="writing-a-submitter-class">
<h2>Writing a Submitter class<a class="headerlink" href="#writing-a-submitter-class" title="Link to this heading">#</a></h2>
<p>The basic template to inherit from the Submitter class can be as simple
as this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">soprano.hpc.submitter</span> <span class="kn">import</span> <span class="n">Submitter</span>

<span class="k">class</span> <span class="nc">MySubmitter</span><span class="p">(</span><span class="n">Submitter</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>However, such a class would be of no use since it does not implement any
particular behaviour. The Submitter class originally has a number of
methods. Some of them are preceded by an underscore and are meant to not
be touched, as they handle the core behaviour of any Submitter. Others
are meant to be overridden when inheriting from the base class and
control custom behaviour - the specifics of the problem at hand. The
core methods determine the Submitter workflow, which can be described as
follows:</p>
<div class="mermaid">
            graph TD
    Z[/&quot;set_parameters()&quot;/]
    A(Sumitter Start) --&gt; B[&quot;start_run()&quot;]
    B --&gt; C[&quot;next_job() Create a definition for the job&quot;]
    C --&gt; D(Create temporary folder for new job)
    D --&gt; E[&quot;setup_job(name, args, folder) Copy or create relevant files here&quot;]
    E --&gt; F(&quot;Replace tags in submission script with appropriate values&quot;)
    F --&gt; G(&quot;Submit job to queue (if necessary, copying to and from remote machine happens here)&quot;)
    G &lt;--&gt; |SSH| H[/&quot;Remote machine&quot;/]
    G --&gt; I[&quot;finish job(name, args, folder) Finalise job and copy files of interest before deletion&quot;]
    I --&gt; J(&quot;Delete temporary folder&quot;)
    J --&gt; K{Stop?}
    K --&gt; |Yes| L[&quot;finish_run()&quot;]
    K --&gt; |No| M(&quot;Wait until check_time has passed&quot;)
    M --&gt; C
        </div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">set_parameters(**kwargs)</span></code> - Must be executed by hand by the user
after creating the Submitter instance. Can be overridden and have
any interface. Since the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method should <em>not</em> be altered,
this method provides a way for the user to feed class-specific
parameters to any derived Submitter types.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start_run()</span></code> - Executed at the beginning of a run. Here any tasks
that are preparatory to initialising the entire run should be
accomplished. By default does nothing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next_job()</span></code> - Executed whenever the Submitter has a free slot to
start a new job. Should return a definition for said job in the form
of a dictionary containing a <code class="docutils literal notranslate"><span class="pre">name</span></code> (in the form of a string) and
some <code class="docutils literal notranslate"><span class="pre">args</span></code> in the form of a dictionary: by default returns
<code class="docutils literal notranslate"><span class="pre">{`name':</span> <span class="pre">`default_job',</span> <span class="pre">`args':</span> <span class="pre">{}}</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setup_job(name,</span> <span class="pre">args,</span> <span class="pre">folder)</span></code> - Executed immediately after
<code class="docutils literal notranslate"><span class="pre">next_job()</span></code> and the creation of a temporary folder to contain its
files. Must perform any operations required to set up the input for
the upcoming calculations. For example, <code class="docutils literal notranslate"><span class="pre">next_job</span></code> could return a
Python object defining an atomic structure on which the calculation
ought to be performed; <code class="docutils literal notranslate"><span class="pre">setup_job</span></code> is where the input files to which
said structure is written should be created and saved in the path
defined by <code class="docutils literal notranslate"><span class="pre">folder</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finish_job(name,</span> <span class="pre">args,</span> <span class="pre">folder)</span></code> - Executed once the job has been
run and the output files are in <code class="docutils literal notranslate"><span class="pre">folder</span></code> (if the job has been run on
a remote machine, at this point the files will have been downloaded
back to the local file system). At this point any post-processing
should be done and any output files of relevance should be <em>copied
to a persistent folder</em>. This is especially important as after this
step the temporary folder will be deleted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finish_run()</span></code> - Executed at the end of the run, takes care of clean
up. If any files need to be closed or resources deallocated this is
the place to do it. By default does nothing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">save_state()</span></code> - Only executed when the Submitter is initialised
with the argument <code class="docutils literal notranslate"><span class="pre">continuation=True</span></code>. This allows the Submitter to
be stopped (or in case of accidents, crash) and store its current
state in order for it to be restarted manually at a later time. By
default the submitter only stores the list of the currently running
jobs so that it can get back to monitoring them; however, here the
user can define any additional data they want to be stored as well,
as long as it can be ‘pickled’ <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. This data must be returned as
members inside a dictionary. This method <em>must</em> return a dictionary,
even if empty. The file is saved as <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;.pkl</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> is
the ‘name’ argument passed to the Submitter’s constructor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">load_state(loaded_data)</span></code> - Only executed when the Submitter is
initialised with the argument <code class="docutils literal notranslate"><span class="pre">continuation=True</span></code> and a previously
saved state file is found. Receives as argument a dictionary
containing the saved data; this should be in the same format as the
one returned by <code class="docutils literal notranslate"><span class="pre">save_state</span></code>. In general it should perform the same
operations in reverse, restoring the Submitter to its original
state.</p></li>
</ul>
</section>
<section id="writing-a-tagged-submission-script">
<h2>Writing a tagged submission script<a class="headerlink" href="#writing-a-tagged-submission-script" title="Link to this heading">#</a></h2>
<p>When submitting a job to a queueing system, one needs to do so in the
form of a script, which usually contains the desired commands as well as
a number of comments functioning as parameters for the queueing system
itself. In the simplest case, this script could be limited to an
executable (the program we need to run) and the name of its input file.
When creating jobs with a Submitter, this script will be ran from within
the folder in which the input files have been created with <code class="docutils literal notranslate"><span class="pre">setup_job</span></code>;
however, it is reasonable to imagine that these might have different
file names or parameters from job to job. To account for that, when one
creates a submitter, a script is passed to in which any word that is
supposed to change is replaced by a tag surrounded by angle brackets.
The main purpose for this is to use the argument <code class="docutils literal notranslate"><span class="pre">name</span></code>; the same can be
done with any element appearing in the <code class="docutils literal notranslate"><span class="pre">args</span></code> dictionary returned as
part of the output of <code class="docutils literal notranslate"><span class="pre">next_job</span></code>. So for example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;sentence&gt;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>&lt;name&gt;.txt
</pre></div>
</div>
<p>for a job defined as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> 
 <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sentence&#39;</span><span class="p">:</span> 
          <span class="s1">&#39;Hello World!&#39;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>would produce a file named <code class="docutils literal notranslate"><span class="pre">hello.txt</span></code> containing the sentence “Hello
World!”.</p>
</section>
<section id="creating-a-submitter-instance">
<h2>Creating a Submitter instance<a class="headerlink" href="#creating-a-submitter-instance" title="Link to this heading">#</a></h2>
<p>Given that one has created and specified a derived Submitter class and a
properly tagged submission script, it is then necessary to create a file
that defines an instance of the Submitter itself. Assuming that we
already imported the definition of the new class, the basic template for
such a file will be</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">soprano.hpc.submitter</span> <span class="kn">import</span> <span class="n">QueueInterface</span>

<span class="c1"># Other interfaces supported are LSF and PBS,</span>
<span class="c1"># plus you can define your own.</span>
<span class="n">myQ</span> <span class="o">=</span> <span class="n">QueueInterface</span><span class="o">.</span><span class="n">GridEngine</span><span class="p">()</span> 
<span class="c1"># Here we load the script</span>
<span class="n">myScr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tagged_script.sh&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">mySub</span> <span class="o">=</span> <span class="n">MySubmitter</span><span class="p">(</span><span class="s1">&#39;test_submitter&#39;</span><span class="p">,</span> <span class="n">myQ</span><span class="p">,</span> <span class="n">myScr</span><span class="p">)</span>
<span class="n">mySub</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c1"># Any parameters needed...</span>
</pre></div>
</div>
<p>The constructor for a Submitter takes a number of optional parameters
beyond the three obligatory ones (name, queue interface and script).
They can all be found in the documentation but for convenience here’s a
rundown:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_jobs</span> <span class="pre">(Optional[int])</span></code> - maximum number of jobs to submit at a
given time. When this number of job has been submitted to the queue,
the Submitter stops and waits until one of them is complete. Default
is 4.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">check_time</span> <span class="pre">(Optional[float])</span></code> - time in seconds between consecutive
checks for the queue status and attempts to submit new jobs. Default
is 10.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_time</span> <span class="pre">(Optional[float])</span></code> - time in seconds the Submitter will
run for before shutting down. If set to zero the thread won’t stop
until killed with Submitter.stop.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">temp_folder</span> <span class="pre">(Optional[str])</span></code> - where to store the temporary folders
for the calculations. By default it’s the current folder.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remote_workdir</span> <span class="pre">(Optional[str])</span></code> - if present, uses a directory on a
remote machine by logging in via SSH. Must be in the format
<code class="docutils literal notranslate"><span class="pre">&lt;host&gt;:&lt;path/to/directory&gt;</span></code> (without the angle brackets, replace
host name and directory suitably; the directory must already exist).
Host must be defined in the user’s <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span> <span class="pre">file</span></code> - check the
docs for RemoteTarget for more information. It is possible to omit
the colon and directory, that will use the home directory of the
given folder; that is HEAVILY DISCOURAGED though. Best practice
would be to create an empty directory on the remote machine and use
that, to avoid accidental overwriting/deleting of important files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remote_getfiles</span> <span class="pre">(Optional[list(str)])</span></code> - list of files to be
downloaded from the remote copy of the job’s temporary directory. By
default, all of them. Can be a list using specific names or
wildcards. Filenames can also use the placeholder name to signify
the job name, as well as any other element from the arguments.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssh_timeout</span> <span class="pre">(Optional[float])</span></code> - connection timeout in seconds.
Default is 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">continuation</span> <span class="pre">(Optional[bool])</span></code> - if True, when the Submitter is
stopped it will not terminate the current jobs; rather, it will
store the list of ongoing jobs in a pickle file. If the submitter is
ran again from the same folder then it will “pick up from where it
left” and try recovering those jobs, then restart. If one wishes
for additional values to be saved and restored, the <code class="docutils literal notranslate"><span class="pre">save_state</span></code> and
<code class="docutils literal notranslate"><span class="pre">load_state</span></code> methods need to be defined.</p></li>
</ul>
</section>
<section id="launching-a-submitter">
<h2>Launching a Submitter<a class="headerlink" href="#launching-a-submitter" title="Link to this heading">#</a></h2>
<p>Finally, once everything in place, it is possible to launch the
Submitter. This is done by running the command <code class="docutils literal notranslate"><span class="pre">soprano_submitter.py</span></code>.
The syntax is described as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>soprano_submitter.py [-h] [-n N] [-nohup] action submitter_file
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">submitter_file</span></code> is the name of the file in which the <em>instance</em>
of the Submitter was created (as described in
<a class="reference internal" href="#creating-a-submitter-instance"><span class="xref myst">2.3</span></a>)
and <code class="docutils literal notranslate"><span class="pre">action</span></code> can be one of <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">stop</span></code> or <code class="docutils literal notranslate"><span class="pre">list</span></code>. The previous two
are pretty self-explanatory; the third lists which Submitters, among the
ones defined in the given file, are running, and how long they have
been. The additional options work as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-h</span></code> - display the help message</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">N</span></code> - launch the submitter of name N. This must be used when
multiple Submitters are instanced in <code class="docutils literal notranslate"><span class="pre">submitter_file</span></code>. The name must
be the name of the variable (so for example in the example in
<a class="reference internal" href="#creating-a-submitter-instance"><span class="xref myst">2.3</span></a>, that would be <code class="docutils literal notranslate"><span class="pre">mySub</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-nohup</span></code> - put the Submitter thread in ‘no hangup’ mode, meaning
that it will keep running even if one closes the terminal session
from which it was launched. This is mainly for the case in which a
Submitter was launched on a machine to which we connect remotely via
<code class="docutils literal notranslate"><span class="pre">ssh</span></code>.</p></li>
</ul>
<p>When a Submitter is started it runs in the background of a shell session
until <code class="docutils literal notranslate"><span class="pre">max_time</span></code> seconds have passed or it is explicitly stopped. When
stopped, if <code class="docutils literal notranslate"><span class="pre">continuation=True</span></code> wasn’t set, it kills all still ongoing
jobs and deletes all the temporary folders; otherwise it leaves
everything running and stores a pickled file with the pattern
<code class="docutils literal notranslate"><span class="pre">&lt;submitter_name&gt;.pkl</span></code> in the current folder from which it can pick back
up. Deleting the file in question is equivalent to resetting the run.
During and at the end of a run, a log file called <code class="docutils literal notranslate"><span class="pre">&lt;submitter_name&gt;.log</span></code>
is available containing messages detailing the workings of the
Submitter. When defining a new Submitter class, one can use the method
<code class="docutils literal notranslate"><span class="pre">self.log('Message')</span></code> inside it to write to this log file additional
lines.</p>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>For more information on the process of serialisation, or
‘pickling’, in Python, see:
<a class="reference external" href="https://docs.python.org/3/library/pickle.html">https://docs.python.org/3/library/pickle.html</a></p>
</aside>
</aside>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="tutorials/06-defect_calculations.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tutorial 6 - Soprano for defect calculations</p>
      </div>
    </a>
    <a class="right-next"
       href="api.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">API reference</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Job Submitter</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#deploying-a-submitter">Deploying a Submitter</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-a-submitter-class">Writing a Submitter class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-a-tagged-submission-script">Writing a tagged submission script</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-submitter-instance">Creating a Submitter instance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#launching-a-submitter">Launching a Submitter</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By CCP-NC
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>